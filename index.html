<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no" />
  <title>タリスポッド</title>

  <!-- 既存デザインは app.css 前提 -->
  <link rel="stylesheet" href="./css/app.css?v=077" />

  <!-- iPhoneの入力ズーム抑制（既存CSSがある前提だが保険） -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
</head>

<body>
  <!-- =========================
       全体ラッパー（CSSが効く前提の構造）
       ========================= -->
  <div class="app">

    <!-- =========================
         ヘッダー（固定）
         - カムバックはヘッダー領域
         ========================= -->
    <header class="app-header" id="appHeader">
      <div class="header-left">
        <div class="brand">【タリスポッド】</div>

        <div class="header-lines">
          <div id="headerLine1" class="header-line"></div>
          <div id="headerLine2" class="header-line"></div>
          <div id="headerLine3" class="header-line"></div>
        </div>
      </div>

      <div class="header-right">
        <button id="comebackBtn" class="btn comeback-btn" type="button">カムバック</button>
      </div>
    </header>

    <!-- =========================
         未リボーン画面
         ========================= -->
    <main id="startView" class="view view-start active">
      <section class="panel panel-start">
        <h2 class="panel-title">サーガの名を刻め</h2>

        <div class="field">
          <label for="sagaInput">サーガ名</label>
          <input id="sagaInput" type="text" inputmode="text" autocomplete="name" />
        </div>

        <h2 class="panel-title">ソウルドールの記憶からリボーン</h2>
        <div class="field">
          <label for="soulTextInput">記憶</label>
          <textarea id="soulTextInput" rows="4" placeholder="SOUL:..." spellcheck="false"></textarea>
        </div>

        <div class="actions">
          <button id="textRebornBtn" class="btn primary" type="button">記憶からリボーンする</button>
        </div>

        <h2 class="panel-title">新たなソウルドールを見つける</h2>
        <div class="actions">
          <button id="newSoulBtn" class="btn" type="button">新たなソウルドールを見つける</button>
        </div>
      </section>
    </main>

    <!-- =========================
         メイン画面（タブUI）
         ========================= -->
    <main id="mainView" class="view view-main">
      <!-- ====== HOME ====== -->
      <section id="tab-home" class="tab-content active" aria-label="home">
        <div class="scene">

          <!-- 環境表示（色が変わる領域：既存CSS/JSに合わせて維持） -->
          <div class="scene-top">
            <div class="env-badge">
              <div id="envAttributeLabel" class="env-attr">無属性</div>
              <div class="env-timer">
                <span id="growthTimer">環境成長なし</span>
                <span id="growthPreview" class="growth-preview"></span>
              </div>
            </div>
          </div>

          <!-- スプライト -->
          <div class="sprite-wrap">
            <div id="spriteMover" class="sprite-mover">
              <div id="spriteViewport" aria-label="legendz-sprite">
                <div id="spriteSheetLayer"></div>
                <div id="spriteFxLayer"></div>
              </div>
            </div>
          </div>

          <!-- 無属性環境にする：レジェンズ領域“外”（その下） -->
          <div class="home-neutral-wrap">
            <button id="homeNeutralBtn" class="btn" type="button">無属性環境にする</button>
          </div>
        </div>
      </section>

      <!-- ====== ENVIRONMENT ====== -->
      <section id="tab-environment" class="tab-content" aria-label="environment">
        <div class="panel">
          <div class="env-preview-row">
            <div class="env-preview-label">予想環境：</div>
            <div id="envPreviewLabel" class="env-preview-value">無属性</div>
          </div>

          <div class="env-controls">
            <!-- 無属性に戻す：スライダーの上（押した瞬間デフォルト） -->
            <div class="env-neutral-top">
              <button id="neutralBtn" class="btn" type="button">無属性に戻す</button>
            </div>

            <div class="env-row">
              <div class="env-row-head">
                <div class="env-row-title">温度</div>
                <div id="tempValue" class="env-row-value">0℃</div>
              </div>
              <input id="tempSlider" type="range" />
            </div>

            <div class="env-row">
              <div class="env-row-head">
                <div class="env-row-title">湿度</div>
                <div id="humidityValue" class="env-row-value">50％</div>
              </div>
              <input id="humiditySlider" type="range" />
            </div>

            <div class="env-row">
              <div class="env-row-head">
                <div id="lightLabel" class="env-row-title">光量</div>
                <div id="lightValue" class="env-row-value">50</div>
              </div>

              <!-- 光量 0/50/100（湿度100時は水深として扱う：JS側） -->
              <div class="light-btns">
                <button id="lightBtn0" class="btn light-btn" type="button">0</button>
                <button id="lightBtn50" class="btn light-btn active" type="button">50</button>
                <button id="lightBtn100" class="btn light-btn" type="button">100</button>
              </div>
            </div>

            <div class="actions">
              <button id="applyEnvBtn" class="btn primary" type="button">環境決定</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ====== LEGENDZ ====== -->
      <section id="tab-legendz" class="tab-content" aria-label="legendz">
        <div class="panel">
          <div class="legendz-header">
            <div class="legendz-line">
              <span id="speciesName">ウインドラゴン</span>
              <span class="dot">/</span>
              <span id="legendzAttribute">トルネード</span>
            </div>

            <!-- ニックネームは各ステータスの上 -->
            <div class="field nick-field">
              <label for="nicknameInput">ニックネーム</label>
              <div class="nick-row">
                <input id="nicknameInput" type="text" inputmode="text" autocomplete="off" />
                <button id="nicknameApplyBtn" class="btn" type="button">変更</button>
              </div>
            </div>
          </div>

          <div class="stats">
            <div class="stat"><div class="k">HP</div><div id="hpStat" class="v">0/0</div></div>
            <div class="stat"><div class="k">マホウ</div><div id="magicStat" class="v">0</div></div>
            <div class="stat"><div class="k">カウンター</div><div id="counterStat" class="v">0</div></div>
            <div class="stat"><div class="k">ダゲキ</div><div id="strikeStat" class="v">0</div></div>
            <div class="stat"><div class="k">カイフク</div><div id="healStat" class="v">0</div></div>
          </div>

          <h3 class="panel-subtitle">ワザスロット（15）</h3>
          <div id="skillSlots" class="skill-slots"></div>
        </div>
      </section>

      <!-- ====== CRYSTAL ====== -->
      <section id="tab-crystal" class="tab-content" aria-label="crystal">
        <div class="panel">
          <h2 class="panel-title">クリスタル</h2>
          <div id="crystalList" class="crystal-list"></div>
        </div>
      </section>

      <!-- =========================
           タブ（下部固定）
           ========================= -->
      <nav class="tabs" aria-label="tabs">
        <button class="tab-btn active" data-tab="home" type="button">ホーム</button>
        <button class="tab-btn" data-tab="environment" type="button">環境</button>
        <button class="tab-btn" data-tab="legendz" type="button">レジェンズ</button>
        <button class="tab-btn" data-tab="crystal" type="button">クリスタル</button>
      </nav>
    </main>

  </div><!-- /.app -->

  <!-- =========================
       JS 読み込み（file://対応／順番固定）
       ========================= -->
  <script src="./js/state.js?v=077"></script>
  <script src="./js/areaMap.js?v=077"></script>
  <script src="./js/areaResolver.js?v=077"></script>
  <script src="./js/game.js?v=077"></script>
  <script src="./js/app.js?v=077"></script>
</body>
</html>
